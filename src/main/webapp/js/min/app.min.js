var app=angular.module("ecargoApp",["ngAnimate","ui.bootstrap"]);app.controller("productController",["$scope","$modal","productService",function(e,r,t){t.queryProduct(e),e.search=function(){var r=e.searchBrandId;t.searchClickEnvent(r,e)},e.open=function(t){var n=r.open({animation:e.animationsEnabled,templateUrl:"myModalContent.html",controller:"ModalInstanceCtrl",size:""});n.product=t}}]),app.controller("ModalInstanceCtrl",["$scope","$modalInstance","reviewService",function(e,r,t){e.product=r.product,e.ok=function(){return void 0==e.inputEmail||""==e.inputEmail?(e.emailErrorMsg="input must be email format",void setTimeout(function(){document.getElementById("userEmail").focus()},100)):(e.formData={useremail:e.inputEmail,productid:e.product.id,rating:e.x,comment:void 0==e.inputComment?"":e.inputComment},void t.createReview(e,r))},e.cancel=function(){r.dismiss("cancel")},e.isReadonly=!1,e.hoveringOver=function(r){e.x=r},e.ratingStates=[{stateOn:"glyphicon-ok-sign",stateOff:"glyphicon-ok-circle"},{stateOn:"glyphicon-star",stateOff:"glyphicon-star-empty"},{stateOn:"glyphicon-heart",stateOff:"glyphicon-ban-circle"},{stateOn:"glyphicon-heart"},{stateOff:"glyphicon-off"}]}]),app.factory("productService",["$http",function(e){var r=function(r){e.get("/ecargo/product/query").then(function(e){r.products=e.data,r.isEmpty=0==e.data.length?!0:!1},function(){alert("query product error occured!")})},t=function(r,t){e.get("/ecargo/product/query/"+r).then(function(e){t.products=e.data,t.isEmpty=0==e.data.length?!0:!1},function(){alert("query product error occured!")})},n=function(e,r){""==e||void 0==e?this.queryProduct(r):this.queryProductByBrandId(e,r)};return{queryProduct:r,queryProductByBrandId:t,searchClickEnvent:n}}]),app.factory("userService",["$http",function(e){var r=function(r,t,n){e.get("/ecargo/user/query?useremail="+t).then(function(e){r.user=e.data,n()},function(){alert("query user error occured!")})};return{getUserByUserEmail:r}}]),app.factory("reviewService",["$http","$httpParamSerializer","userService",function(e,r,t){var n=function(n,o){e({method:"POST",url:"/ecargo/review/create",data:r(n.formData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){var r=e.data;if("success"==r.code){o.dismiss("cancel");var a=function(){n.product.review.rating=n.formData.rating,n.product.review.summary=n.formData.comment,n.product.review.userName=n.user.name};t.getUserByUserEmail(n,n.formData.useremail,a)}else n.emailErrorMsg=r.errorMsg,setTimeout(function(){document.getElementById("userEmail").focus()},100)},function(){alert("create review error occured, please contact manager!"),n.emailErrorMsg="create review error occured!"})};return{createReview:n}}]);